<?xml version="1.0"?>
<configuration>

  <system.web>
    <compilation debug="true" targetFramework="4.5"/>
    <httpRuntime targetFramework="4.5" enableVersionHeader="false"/>

    <authorization>
      <allow users="?"/>
    </authorization>
  </system.web>

  <system.webServer>

    <urlCompression doDynamicCompression="true" doStaticCompression="true" dynamicCompressionBeforeCache="true"/>

    <staticContent>
      <clientCache cacheControlMaxAge="365.00:00:00" cacheControlMode="UseMaxAge"/>
    </staticContent>

    <httpErrors errorMode="Custom" existingResponse="Replace">
      <remove statusCode="404"/>
      <error statusCode="404" path="/404" responseMode="ExecuteURL"/>
    </httpErrors>

    <rewrite>

      <rules>
        <rule name="CDN Passthrough" stopProcessing="true">
          <match url="(.*)(cdn/)([\S]+)" />
          <action type="Rewrite" url="{R:1}/{R:3}"/>
        </rule>
        <rule name="Remove WWW" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTP_HOST}" pattern="^(www\.)(.*)$"/>
          </conditions>
          <action type="Redirect" url="https://{C:2}{PATH_INFO}" redirectType="Permanent"/>
        </rule>
        <rule name="Redirect to .com" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTP_HOST}" pattern="(.*)(\.co.uk)$"/>
          </conditions>
          <action type="Redirect" url="https://{C:1}.com{PATH_INFO}" redirectType="Permanent"/>
        </rule>
      </rules>
      <outboundRules>
        <rule name="Remove ETag header">
          <match serverVariable="RESPONSE_ETag" pattern=".+"/>
          <action type="Rewrite" value=""/>
        </rule>
        <rule name="Send correct Vary header">
          <match serverVariable="RESPONSE_Vary" pattern=".+"/>
          <action type="Rewrite" value="Accept-Encoding, If-Modified-Since"/>
        </rule>
      </outboundRules>
    </rewrite>

    <httpProtocol>
      <customHeaders>
        <remove name="X-Powered-By" />
        <add name="X-Frame-Options" value="DENY" />
        <add name="Arr-Disable-Session-Affinity" value="True" />
        <add name="Content-Security-Policy" value="default-src 'self'; img-src 'self' data: https://az680800.vo.msecnd.net/; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://az416426.vo.msecnd.net/ https://fonts.googleapis.com/; style-src 'self' https://az680800.vo.msecnd.net/ https://fonts.googleapis.com/; font-src https://fonts.gstatic.com/; connect-src https://dc.services.visualstudio.com/;" />
        <add name="X-XSS-Protection" value="1; mode=block" />
        <add name="X-Content-Type-Options" value="nosniff" />
      </customHeaders>
    </httpProtocol>

  </system.webServer>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Helpers" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.WebPages" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-3.0.0.0" newVersion="3.0.0.0"/>
      </dependentAssembly>
      <dependentAssembly>
        <assemblyIdentity name="System.Web.Mvc" publicKeyToken="31bf3856ad364e35"/>
        <bindingRedirect oldVersion="1.0.0.0-5.1.0.0" newVersion="5.1.0.0"/>
      </dependentAssembly>
    </assemblyBinding>
  </runtime>
 
</configuration>